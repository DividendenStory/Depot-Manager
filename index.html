<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Depot Manager</title>
    <!-- Tailwind CSS für modernes Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel, um JSX direkt im Browser zu kompilieren -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React und ReactDOM von einem CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Recharts von einem CDN. Die onload-Funktion stellt sicher, dass die App erst nach dem Laden des Skripts gerendert wird. -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js" onload="renderApp()"></script>

    <style>
        /* Zusätzliches Styling für die Scroll-Leiste */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-50 flex items-center justify-center min-h-screen p-4">
    <div id="root" class="w-full max-w-4xl"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Beispieldaten für das Depot
        const initialPortfolioData = [
            { id: 1, name: "Stock A", color: "#8884d8", data: [
                { date: '2023-01-01', value: 100 },
                { date: '2023-02-01', value: 120 },
                { date: '2023-03-01', value: 115 },
                { date: '2023-04-01', value: 130 },
                { date: '2023-05-01', value: 145 },
            ]},
            { id: 2, name: "Stock B", color: "#82ca9d", data: [
                { date: '2023-01-01', value: 250 },
                { date: '2023-02-01', value: 230 },
                { date: '2023-03-01', value: 260 },
                { date: '2023-04-01', value: 275 },
                { date: '2023-05-01', value: 290 },
            ]},
            { id: 3, name: "Stock C", color: "#ffc658", data: [
                { date: '2023-01-01', value: 80 },
                { date: '2023-02-01', value: 95 },
                { date: '2023-03-01', value: 90 },
                { date: '2023-04-01', value: 105 },
                { date: '2023-05-01', value: 110 },
            ]},
        ];

        // Die Haupt-Anwendungskomponente
        function App() {
            const [portfolio, setPortfolio] = useState(initialPortfolioData);
            const [selectedStock, setSelectedStock] = useState(initialPortfolioData[0]);
            const [showModal, setShowModal] = useState(false);
            const [newStock, setNewStock] = useState({ name: '', data: '' });
            const [alertMessage, setAlertMessage] = useState('');

            // Funktion zum Hinzufügen einer neuen Aktie
            const addStock = () => {
                if (!newStock.name || !newStock.data) {
                    setAlertMessage("Name und Daten dürfen nicht leer sein.");
                    return;
                }
                
                try {
                    // Daten-String in ein Array von Objekten umwandeln
                    const dataArray = newStock.data.split(';').map(item => {
                        const [date, value] = item.split(':').map(part => part.trim());
                        return { date, value: parseFloat(value) };
                    });

                    // Eine neue Aktie zum Portfolio hinzufügen
                    const newId = portfolio.length > 0 ? Math.max(...portfolio.map(s => s.id)) + 1 : 1;
                    const newColor = `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;
                    const stockToAdd = { id: newId, name: newStock.name, color: newColor, data: dataArray };

                    setPortfolio([...portfolio, stockToAdd]);
                    setSelectedStock(stockToAdd); // Neue Aktie direkt auswählen
                    setShowModal(false);
                    setNewStock({ name: '', data: '' });
                    setAlertMessage('');

                } catch (error) {
                    setAlertMessage("Fehler beim Parsen der Daten. Bitte verwenden Sie das Format 'Datum:Wert;Datum:Wert'.");
                }
            };
            
            // Funktion zum Löschen einer Aktie
            const deleteStock = (id) => {
                const updatedPortfolio = portfolio.filter(stock => stock.id !== id);
                setPortfolio(updatedPortfolio);
                if (selectedStock && selectedStock.id === id) {
                    setSelectedStock(updatedPortfolio.length > 0 ? updatedPortfolio[0] : null);
                }
            };

            // Daten für das Diagramm aus der ausgewählten Aktie
            const chartData = selectedStock ? selectedStock.data : [];

            // Die Recharts-Komponenten müssen hier deklariert werden, um im JSX verwendet zu werden
            const {
                LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer
            } = Recharts;

            return (
                <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 flex flex-col md:flex-row gap-6 border border-gray-200 dark:border-gray-700">
                    {/* Linke Spalte: Aktienliste und Buttons */}
                    <div className="md:w-1/3 flex flex-col gap-4 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-700 pb-4 md:pb-0 md:pr-6">
                        <h2 className="text-xl font-bold text-gray-800 dark:text-white">Mein Depot</h2>
                        <div className="flex flex-col gap-2 overflow-y-auto max-h-64 md:max-h-full">
                            {portfolio.map((stock) => (
                                <div key={stock.id} className="flex justify-between items-center bg-gray-100 dark:bg-gray-700 rounded-lg p-3 cursor-pointer transition-all duration-300 hover:bg-gray-200 dark:hover:bg-gray-600 shadow-sm"
                                    onClick={() => setSelectedStock(stock)}>
                                    <span className="font-medium text-gray-700 dark:text-gray-200">{stock.name}</span>
                                    <button onClick={(e) => { e.stopPropagation(); deleteStock(stock.id); }} className="text-red-500 hover:text-red-700 transition-colors duration-300 text-sm font-semibold">
                                        Löschen
                                    </button>
                                </div>
                            ))}
                        </div>
                        <button
                            onClick={() => setShowModal(true)}
                            className="w-full mt-4 bg-indigo-600 text-white font-semibold py-3 px-4 rounded-xl shadow-md hover:bg-indigo-700 transition-colors duration-300"
                        >
                            Neue Aktie hinzufügen
                        </button>
                    </div>

                    {/* Rechte Spalte: Diagramm */}
                    <div className="md:w-2/3 flex flex-col">
                        <h2 className="text-xl font-bold text-gray-800 dark:text-white mb-4">
                            Wertentwicklung: {selectedStock ? selectedStock.name : 'Keine Aktie ausgewählt'}
                        </h2>
                        <div className="flex-grow">
                            <ResponsiveContainer width="100%" height={400}>
                                <LineChart data={chartData} margin={{ top: 20, right: 20, left: 0, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" className="dark:stroke-gray-600"/>
                                    <XAxis dataKey="date" stroke="#6b7280" className="dark:stroke-gray-400"/>
                                    <YAxis stroke="#6b7280" className="dark:stroke-gray-400"/>
                                    <Tooltip contentStyle={{ backgroundColor: 'white', border: '1px solid #ccc', borderRadius: '8px' }}/>
                                    <Legend />
                                    {selectedStock && (
                                        <Line
                                            type="monotone"
                                            dataKey="value"
                                            name={selectedStock.name}
                                            stroke={selectedStock.color}
                                            strokeWidth={2}
                                            dot={{ r: 4 }}
                                            activeDot={{ r: 6 }}
                                        />
                                    )}
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Modal zum Hinzufügen einer neuen Aktie */}
                    {showModal && (
                        <div className="fixed inset-0 bg-gray-600 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 flex items-center justify-center p-4 z-50">
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md">
                                <h3 className="text-xl font-bold mb-4 text-gray-800 dark:text-white">Neue Aktie hinzufügen</h3>
                                {alertMessage && (
                                    <div className="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 p-3 rounded-lg mb-4 text-sm" role="alert">
                                        {alertMessage}
                                    </div>
                                )}
                                <div className="mb-4">
                                    <label htmlFor="stock-name" className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                        Name der Aktie
                                    </label>
                                    <input
                                        type="text"
                                        id="stock-name"
                                        value={newStock.name}
                                        onChange={(e) => setNewStock({ ...newStock, name: e.target.value })}
                                        className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"
                                    />
                                </div>
                                <div className="mb-4">
                                    <label htmlFor="stock-data" className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                        Wertentwicklung (Format: Datum:Wert;Datum:Wert)
                                    </label>
                                    <textarea
                                        id="stock-data"
                                        rows="4"
                                        value={newStock.data}
                                        onChange={(e) => setNewStock({ ...newStock, data: e.target.value })}
                                        className="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"
                                        placeholder="z.B. 2023-01-01:100;2023-02-01:120"
                                    ></textarea>
                                </div>
                                <div className="flex justify-end gap-2">
                                    <button
                                        onClick={() => {
                                            setShowModal(false);
                                            setNewStock({ name: '', data: '' });
                                            setAlertMessage('');
                                        }}
                                        className="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white rounded-xl hover:bg-gray-300 transition-colors"
                                    >
                                        Abbrechen
                                    </button>
                                    <button
                                        onClick={addStock}
                                        className="px-4 py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors"
                                    >
                                        Hinzufügen
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

    </script>
    <!-- Ein separates Skript, das die App rendert, sobald Recharts geladen ist. -->
    <script>
        function renderApp() {
             const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(App, null));
        }
    </script>
</body>
</html>
